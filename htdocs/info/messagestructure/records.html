<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>deepstream.io | A Scalable Server for Realtime Web Apps</title>

	<meta name="viewport" content="width=device-width, initial-scale=1" />

	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<meta name="keywords" content="deepstream, deepstream.io, streaming, realtime, server, socket" />
	<meta name="description" content="A node.js realtime server, supporting data-sync, RPCs, events and WebRTC" />
	<meta name="author" content="Wolfram Hempel" />
	<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
	<link rel="icon" href="/favicon.ico" type="image/x-icon">
	<link rel="stylesheet" type="text/css" href="../../assets/css/navigation.css" />
	<link rel="stylesheet" type="text/css" href="../../assets/css/screen.css" />
	<link rel="stylesheet" type="text/css" href="../../assets/css/api.css" />
	<script type="text/javascript">
	document.createElement( 'header' );
	document.createElement( 'nav' );
	</script>
	<script type="text/javascript" src="../../assets/js/jquery.js"></script>
	<script type="text/javascript" src="../../assets/js/menu.js"></script>
	<script type="text/javascript" src="../../assets/js/prism.js"></script>

	<link href='//fonts.googleapis.com/css?family=Montserrat' rel='stylesheet' type='text/css'>
	<link href='//fonts.googleapis.com/css?family=Quicksand:300,400,700' rel='stylesheet' type='text/css'>
	<link href='//fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
	<link rel="stylesheet" type="text/css" href="../../assets/css/prism.css" />
</head>

<body class="category_info ">
	<div class="mobile-menu">
		<div class="nav mobile-nav">
			<ul>
				<li >
					<a href="../..">Home</a>
				</li>
				
				<li >
					<a href="../../download/">Downloads</a>
				</li>
				
				<li >
					<a href="../../tutorials/getting-started.html">Tutorials</a>
					
				</li>
				
				<li >
					<a href="../../docs/deepstream.html">Documentation</a>
					
				</li>
				
				<li >
					<a href="../../blog/">Blog</a>
				</li>
			
				<li class="active">
					<a href="../../info/">Info</a>
					
						<ul id="subnav">
				<li class="head first">Performance</li>
				<li >
					<a href="../../info/performance-overview.html">Overview</a>
					<div class="isActiveIndicator orangeGradient"></div>
				</li>	
				<li >
					<a href="../../info/performance-single-node-vs-cluster.html">Single Node vs Cluster</a>
					<div class="isActiveIndicator orangeGradient"></div>
				</li>
			
				<li class="head">Protocol</li>
				
				<li >
					<a href="../../info/messagestructure/writing-a-client.html">Writing a Client</a>
					<div class="isActiveIndicator orangeGradient"></div>
				</li>
			
				<li >
					<a href="../../info/messagestructure/index.html">Message Structure</a>
					<div class="isActiveIndicator orangeGradient"></div>
				</li>
			
				<li >
					<a href="../../info/messagestructure/specs.html">All Messages</a>
					<div class="isActiveIndicator orangeGradient"></div>
				</li>
			
				<li class="head">Client Specs</li>
					<li >
						<a href="../../info/messagestructure/parsing.html">
						Parsing</a>
						<div class="isActiveIndicator orangeGradient"></div>
					</li>
					<li >
						<a href="../../info/messagestructure/rpc.html">
						Rpc</a>
						<div class="isActiveIndicator orangeGradient"></div>
					</li>
					<li class="active">
						<a href="../../info/messagestructure/records.html">
						Records</a>
						<div class="isActiveIndicator orangeGradient"></div>
							<ul class="overview">
								<li><a href="#Record Conflicts">Record Conflicts</a></li>
								<li><a href="#Record Connectivity">Record Connectivity</a></li>
								<li><a href="#Record Listen Timeouts">Record Listen Timeouts</a></li>
								<li><a href="#Record Listen">Record Listen</a></li>
								<li><a href="#Record Misc">Record Misc</a></li>
								<li><a href="#Record Subscription">Record Subscription</a></li>
								<li><a href="#Record Timeouts">Record Timeouts</a></li>
								<li><a href="#Record">Record</a></li>
							</ul>
					</li>
					<li >
						<a href="../../info/messagestructure/events.html">
						Events</a>
						<div class="isActiveIndicator orangeGradient"></div>
					</li>
					<li >
						<a href="../../info/messagestructure/connectivity.html">
						Connectivity</a>
						<div class="isActiveIndicator orangeGradient"></div>
					</li>
				
				
			
			</ul>
				
					
				</li>
			
			</ul>		</div>
	</div>

	<div id="outer-wrapper">
		<div id="header" class="compact-header">
			<div class="header-tiny-logo">
				<h1><a href="../..">deepstream.io - a scalable server for realtime web apps</a></h1>
			</div>
			<a href="//deepstreamHub.com/careers"  class="header-hiring-link">
				<span class="header-hiring-text">we're hiring!</span>
			</a>
			<div class="nav desktop-nav">
				<ul>
					<li >
						<a href="../..">Home</a>
					</li>
					
					<li >
						<a href="../../download/">Downloads</a>
					</li>
					
					<li >
						<a href="../../tutorials/getting-started.html">Tutorials</a>
						
					</li>
					
					<li >
						<a href="../../docs/deepstream.html">Documentation</a>
						
					</li>
					
					<li >
						<a href="../../blog/">Blog</a>
					</li>
				
					<li class="active">
						<a href="../../info/">Info</a>
						
							<ul id="subnav">
					<li class="head first">Performance</li>
					<li >
						<a href="../../info/performance-overview.html">Overview</a>
						<div class="isActiveIndicator orangeGradient"></div>
					</li>	
					<li >
						<a href="../../info/performance-single-node-vs-cluster.html">Single Node vs Cluster</a>
						<div class="isActiveIndicator orangeGradient"></div>
					</li>
				
					<li class="head">Protocol</li>
					
					<li >
						<a href="../../info/messagestructure/writing-a-client.html">Writing a Client</a>
						<div class="isActiveIndicator orangeGradient"></div>
					</li>
				
					<li >
						<a href="../../info/messagestructure/index.html">Message Structure</a>
						<div class="isActiveIndicator orangeGradient"></div>
					</li>
				
					<li >
						<a href="../../info/messagestructure/specs.html">All Messages</a>
						<div class="isActiveIndicator orangeGradient"></div>
					</li>
				
					<li class="head">Client Specs</li>
						<li >
							<a href="../../info/messagestructure/parsing.html">
							Parsing</a>
							<div class="isActiveIndicator orangeGradient"></div>
						</li>
						<li >
							<a href="../../info/messagestructure/rpc.html">
							Rpc</a>
							<div class="isActiveIndicator orangeGradient"></div>
						</li>
						<li class="active">
							<a href="../../info/messagestructure/records.html">
							Records</a>
							<div class="isActiveIndicator orangeGradient"></div>
								<ul class="overview">
									<li><a href="#Record Conflicts">Record Conflicts</a></li>
									<li><a href="#Record Connectivity">Record Connectivity</a></li>
									<li><a href="#Record Listen Timeouts">Record Listen Timeouts</a></li>
									<li><a href="#Record Listen">Record Listen</a></li>
									<li><a href="#Record Misc">Record Misc</a></li>
									<li><a href="#Record Subscription">Record Subscription</a></li>
									<li><a href="#Record Timeouts">Record Timeouts</a></li>
									<li><a href="#Record">Record</a></li>
								</ul>
						</li>
						<li >
							<a href="../../info/messagestructure/events.html">
							Events</a>
							<div class="isActiveIndicator orangeGradient"></div>
						</li>
						<li >
							<a href="../../info/messagestructure/connectivity.html">
							Connectivity</a>
							<div class="isActiveIndicator orangeGradient"></div>
						</li>
					
					
				
				</ul>
					
						
					</li>
				
				</ul>			</div>
			<span class="menu-button menu-icon">
				<i class="fa fa-bars"></i>
			</span>
		</div>
		<div id="wrapper" class="main">
			<ul id="subnav">
	<li class="head first">Performance</li>
	<li >
		<a href="../../info/performance-overview.html">Overview</a>
		<div class="isActiveIndicator orangeGradient"></div>
	</li>	
	<li >
		<a href="../../info/performance-single-node-vs-cluster.html">Single Node vs Cluster</a>
		<div class="isActiveIndicator orangeGradient"></div>
	</li>

	<li class="head">Protocol</li>
	
	<li >
		<a href="../../info/messagestructure/writing-a-client.html">Writing a Client</a>
		<div class="isActiveIndicator orangeGradient"></div>
	</li>

	<li >
		<a href="../../info/messagestructure/index.html">Message Structure</a>
		<div class="isActiveIndicator orangeGradient"></div>
	</li>

	<li >
		<a href="../../info/messagestructure/specs.html">All Messages</a>
		<div class="isActiveIndicator orangeGradient"></div>
	</li>

	<li class="head">Client Specs</li>
		<li >
			<a href="../../info/messagestructure/parsing.html">
			Parsing</a>
			<div class="isActiveIndicator orangeGradient"></div>
		</li>
		<li >
			<a href="../../info/messagestructure/rpc.html">
			Rpc</a>
			<div class="isActiveIndicator orangeGradient"></div>
		</li>
		<li class="active">
			<a href="../../info/messagestructure/records.html">
			Records</a>
			<div class="isActiveIndicator orangeGradient"></div>
				<ul class="overview">
					<li><a href="#Record Conflicts">Record Conflicts</a></li>
					<li><a href="#Record Connectivity">Record Connectivity</a></li>
					<li><a href="#Record Listen Timeouts">Record Listen Timeouts</a></li>
					<li><a href="#Record Listen">Record Listen</a></li>
					<li><a href="#Record Misc">Record Misc</a></li>
					<li><a href="#Record Subscription">Record Subscription</a></li>
					<li><a href="#Record Timeouts">Record Timeouts</a></li>
					<li><a href="#Record">Record</a></li>
				</ul>
		</li>
		<li >
			<a href="../../info/messagestructure/events.html">
			Events</a>
			<div class="isActiveIndicator orangeGradient"></div>
		</li>
		<li >
			<a href="../../info/messagestructure/connectivity.html">
			Connectivity</a>
			<div class="isActiveIndicator orangeGradient"></div>
		</li>
	
	

</ul>

			<div id="content">
				<h1>
    Record
</h1>

<link rel="stylesheet" type="text/css" href="../../assets/css/gherkin-highlight.css" />
<link rel="stylesheet" type="text/css" href="../../assets/css/messagestructure.css" />
<script type="text/javascript" src="../../assets/js/messagestructure.js"></script>

<div class="message-in-depth">
     <table>
        <tbody>
            <tr>
                <td>Event</td>
                <td class="event"></td>
            </tr>
            <tr>
                <td>Action</td>
                <td class="action"></td>
            </tr>
            <tr>
                <td>Data</td>
                <td class="data"></td>
            </tr>
        </tbody>
    </table>
    <div class="down-arrow"></div>
</div>
    <div class="section">  
        <a name="Record Conflicts"></a>
        <pre><code class="language-gherkin">@records
Feature: Record Conflicts
	Record conflicts occur most often when the client disconnects, 
	does offline work and then reconnects resulting in a merge issue 
	with other potential edits, but can also occur in rare conditions 
	as part of a race condition. If a conflict does occur, the client 
	should recieve a VERSION_EXISTS error.

	Please note this will change as part of the MERGE epic planned, 
	and users will be notified instead that the write failed and be 
	allowed to effectively merge/rebase it as needed. When 
	implementing please let the core team know so we can collabarate.

Scenario: The client is connected
	Given the test server is ready
		And the client is initialised
		And the server sends the message C|A+
		And the client logs in with username &quot;XXX&quot; and password &quot;YYY&quot;
		And the server sends the message A|A+

Scenario: The server requests a record
	Given the client creates a record named &quot;mergeRecord&quot;

Scenario: The server responds with ack and read
	When the server sends the message R|A|S|mergeRecord+
	And the server sends the message R|R|mergeRecord|100|{&quot;key&quot;:&quot;value1&quot;}+

 Scenario: The client recieves an out of sync update
 	When the server sends the message R|U|mergeRecord|102|{&quot;key&quot;:&quot;value3&quot;}+
 	Then the client throws a &quot;VERSION_EXISTS&quot; error with message &quot;mergeRecord&quot;
 
 Scenario: The client sends an partial update
 	When the client sets the record &quot;mergeRecord&quot; &quot;key&quot; to &quot;value4&quot;
 
 Scenario: The client recieves an error saying version already exists
 	When the server sends the message R|E|VERSION_EXISTS|mergeRecord|102+
 	Then the client throws a &quot;VERSION_EXISTS&quot; error with message &quot;mergeRecord&quot;</code></pre>
    </div>
    <div class="section">  
        <a name="Record Connectivity"></a>
        <pre><code class="language-gherkin">@records
Feature: Record Connectivity
	Record connectivity is slightly more complicated than the other 
	types. We must resubscribe listen patterns, however
	the when rerequesting the read action to resubscribe to records 
	the result from the server must be executed as an update
	rather than an initial read. This is because possible merge 
	conflicts may occur if versions are not in sync while the 
	connection was lost.

Scenario: The client is connected
	Given the test server is ready
		And the client is initialised
		And the server sends the message C|A+
		And the client logs in with username &quot;XXX&quot; and password &quot;YYY&quot;
		And the server sends the message A|A+

Scenario: The client creates a record
	Given the client creates a record named &quot;connectionRecord&quot;
	Then the last message the server recieved is R|CR|connectionRecord+

Scenario: The server sends a read ACK and read message for connectionRecord
	Given the server sends the message R|A|S|connectionRecord+
		And the server sends the message R|R|connectionRecord|100|{&quot;name&quot;:&quot;John&quot;, &quot;pets&quot;: [{&quot;name&quot;:&quot;Ruffles&quot;, &quot;type&quot;:&quot;dog&quot;,&quot;age&quot;:2}]}+

Scenario: The client listens to recordPrefix
	When the client listens to a record matching &quot;recordPrefix/.*&quot;
	Then the last message the server recieved is R|L|recordPrefix/.*+

Scenario: The server responds with an ACK
	Given the server sends the message R|A|L|recordPrefix/.*+

Scenario: The client loses it connection to the server
	When the connection to the server is lost
	Given two seconds later
	Then the client throws a &quot;connectionError&quot; error with message &quot;Can&#x27;t connect! Deepstream server unreachable on localhost:7777&quot;
		And the clients connection state is &quot;RECONNECTING&quot;

Scenario: The client sends an partial update
	When the client sets the record &quot;connectionRecord&quot; &quot;pets.0.name&quot; to &quot;Max&quot;
	
Scenario: The client reconnects to the server
	When the connection to the server is reestablished
	And the server sends the message C|A+
	Then the clients connection state is &quot;AUTHENTICATING&quot;

Scenario: The client successfully reconnects
	Given the client logs in with username &quot;XXX&quot; and password &quot;YYY&quot;
		And the server sends the message A|A+
	Then the clients connection state is &quot;OPEN&quot;

Scenario: The client resends the record subscription
	Then the server received the message R|CR|connectionRecord+

Scenario: The client resends the listen record
	Then the server received the message R|L|recordPrefix/.*+

Scenario: The client sends offline changes
	Then the server received the message R|P|connectionRecord|101|pets.0.name|SMax+</code></pre>
    </div>
    <div class="section">  
        <a name="Record Listen Timeouts"></a>
        <pre><code class="language-gherkin">@records
Feature: Record Listen Timeouts
	Whenever a listen subscribe or unsubscribe event does not recieve 
	an acknolowdgement from the server the client should emit an ack 
	timeout error so that the client can attempt to retry.

Scenario: The client is connected
	Given the test server is ready
		And the client is initialised
		And the server sends the message C|A+
		And the client logs in with username &quot;XXX&quot; and password &quot;YYY&quot;
		And the server sends the message A|A+

Scenario: The client listens to recordPrefix
	When the client listens to a record matching &quot;recordPrefix/.*&quot;
	Then the last message the server recieved is R|L|recordPrefix/.*+

@timeout
Scenario: The server does not respond in time with a listen ACK
	When some time passes
	Then the client throws a &quot;ACK_TIMEOUT&quot; error with message &quot;No ACK message received in time for recordPrefix/.*&quot;

Scenario: The client unlistens to recordPrefix
	When the client unlistens to a record matching &quot;recordPrefix/.*&quot;
	Then the last message the server recieved is R|UL|recordPrefix/.*+

@timeout
Scenario: The server does not respond in time with an unlisten ACK
	#When some time passes
	#Then the client throws a &quot;ACK_TIMEOUT&quot; error with message &quot;No ACK message received in time for recordPrefix/.*&quot;</code></pre>
    </div>
    <div class="section">  
        <a name="Record Listen"></a>
        <pre><code class="language-gherkin">@records
Feature: Record Listen
	Listening to Record usage allows the client to reduce the amount 
	of records it needs to update. If a client requests a record that 
	matches your pattern or when all the clients discard it you&#x27;ll be 
	told so you can only need to update records that you know are 
	being listened used.

	This helps reduce the amount of updates you have in the system at 
	any time. Please note,  when using records to update values within
	the deepstream database which is also queried you will need to 
	ensure those records are requested for the query to work with the 
	latest data, or avoid using listen for those records.

Scenario: The client is connected
	Given the test server is ready
		And the client is initialised
		And the server sends the message C|A+
		And the client logs in with username &quot;XXX&quot; and password &quot;YYY&quot;
		And the server sends the message A|A+

Scenario: The client listens to recordPrefix
	When the client listens to a record matching &quot;recordPrefix/.*&quot;
	Then the last message the server recieved is R|L|recordPrefix/.*+

Scenario: The server responds with a listen ACK
	Given the server sends the message R|A|L|recordPrefix/.*+

Scenario: The client gets notified of new matching subscriptions
	Given the server sends the message R|SP|recordPrefix/.*|recordPrefix/foundAMatch+
	Then the client will be notified of new record match &quot;recordPrefix/foundAMatch&quot;

Scenario: The client gets notified for removed subscriptions
	Given the server sends the message R|SR|recordPrefix/.*|recordPrefix/foundAMatch+
	Then the client will be notified of record match removal &quot;recordPrefix/foundAMatch&quot;

Scenario: The client unlistens to recordPrefix
	When the client unlistens to a record matching &quot;recordPrefix/.*&quot;
	Then the last message the server recieved is R|UL|recordPrefix/.*+

Scenario: The server responds with an unlisten ACK
	#TODO
	#Given the server sends the message R|A|UL|recordPrefix/.*+

Scenario: Following server updates will throw an error
	Given the server sends the message R|SP|recordPrefix/.*|recordPrefix/foundAMatch+
	#TODO: This error message isn&#x27;t great
	And the client throws a &quot;UNSOLICITED_MESSAGE&quot; error with message &quot;recordPrefix/.*&quot;</code></pre>
    </div>
    <div class="section">  
        <a name="Record Misc"></a>
        <pre><code class="language-gherkin">@records
Feature: Record Misc
	This feature covers other possible scenarios that can occur, such 
	as the client requesting the same record multiple times.

Scenario: The client is connected
	Given the test server is ready
		And the client is initialised
		And the server sends the message C|A+
		And the client logs in with username &quot;XXX&quot; and password &quot;YYY&quot;
		And the server sends the message A|A+

Scenario: The client attempts to request the same record multiple times. This should still
		only trigger a single subscribe message to the server and the incoming events should
		be multiplexed on the client

	Given the server resets its message count
	When the client creates a record named &quot;doubleRecord&quot;
		And the server sends the message R|A|S|doubleRecord+
		And the server sends the message R|R|doubleRecord|100|{&quot;name&quot;:&quot;John&quot;, &quot;pets&quot;: [{&quot;name&quot;:&quot;Ruffles&quot;, &quot;type&quot;:&quot;dog&quot;,&quot;age&quot;:2}]}+
		And the client creates a record named &quot;doubleRecord&quot;
	Then the last message the server recieved is R|CR|doubleRecord+
		And the server has received 1 messages
</code></pre>
    </div>
    <div class="section">  
        <a name="Record Subscription"></a>
        <pre><code class="language-gherkin">@records
Feature: Record Subscription
	Record subscriptions is done purely on the client side. Whenever 
	an update is recieved for a record, you should find out if anyone 
	is interested and then notify them. When implementing, please keep
	in mind the difference between an update and a patch.

	Updates mean you should fully discard the data that you had, and 
	replace it with the data recieved. 

	Patch means you should apply the diff onto the data you currently 
	have.

	From the clients callback perspective there isn&#x27;t really a 
	difference when recieving updates or patches, since the 
	new data is compared against the old and only the differences 
	are provided to the callback

Scenario: The client is connected
	Given the test server is ready
		And the client is initialised
		And the server sends the message C|A+
		And the client logs in with username &quot;XXX&quot; and password &quot;YYY&quot;
		And the server sends the message A|A+

Scenario: The client creates a record
	When the client creates a record named &quot;subscribeRecord&quot;
	Then the last message the server recieved is R|CR|subscribeRecord+

Scenario: The server responds with an ack and the initial read
	When the server sends the message R|A|S|subscribeRecord+
		And the server sends the message R|R|subscribeRecord|124|{&quot;name&quot;:&quot;Smith&quot;,&quot;pets&quot;:[{&quot;name&quot;:&quot;Ruffus&quot;,&quot;type&quot;:&quot;dog&quot;,&quot;age&quot;:0}]}+

# Full Subscribe

Scenario: The client subscribes to subscribeRecord
	When the client subscribes to the entire record &quot;subscribeRecord&quot; changes
	Then the client will not be notified of the record change

Scenario: The client record subscribeRecord receives updated data it will notify subscribers
	When the server sends the message R|U|subscribeRecord|125|{&quot;name&quot;:&quot;Smith&quot;,&quot;pets&quot;:[{&quot;name&quot;:&quot;Ruffus&quot;,&quot;type&quot;:&quot;dog&quot;,&quot;age&quot;:1}]}+
	Then the client will be notified of the record change

Scenario: The client record subscribeRecord receives partial data it will notify subscribers
	When the server sends the message R|P|subscribeRecord|126|pets.0.name|SRuffusTheSecond+
	Then the client will be notified of the partial record change

Scenario: The client will no longer get notified after it unsubscribes
	Given the client unsubscribes to the entire record &quot;subscribeRecord&quot; changes
	When the server sends the message R|U|subscribeRecord|127|{&quot;name&quot;:&quot;Smith&quot;,&quot;pets&quot;:[{&quot;name&quot;:&quot;Ruffus&quot;,&quot;type&quot;:&quot;dog&quot;,&quot;age&quot;:1}]}+
	Then the client will not be notified of the record change

# Path Susbcribe

Scenario: The client subscribes subscribeRecord to the path pets.0
	When the client subscribes to &quot;pets.0.age&quot; for the record &quot;subscribeRecord&quot;
	Then the client will not be notified of the record change

Scenario: The client receives an partial update unrelated to the path subscribed to
	When the server sends the message R|P|subscribeRecord|128|name|SJohn Smith+
	Then the client will not be notified of the record change

Scenario: The client receives an full update where the pets age hasn&#x27;t changed
	When the server sends the message R|U|subscribeRecord|129|{&quot;name&quot;:&quot;John Smith&quot;, &quot;age&quot;: 21, &quot;pets&quot;: [{&quot;name&quot;:&quot;Ruffus&quot;, &quot;type&quot;:&quot;dog&quot;,&quot;age&quot;:1}]}+
	Then the client will not be notified of the record change

Scenario: The client receives an partial update related to the path subscribed to
	When the server sends the message R|P|subscribeRecord|130|pets.0.age|N4+
	Then the client will be notified of the record change

Scenario: The client receives an full update where the pets has changed
	When the server sends the message R|U|subscribeRecord|131|{&quot;name&quot;:&quot;John Smith&quot;, &quot;age&quot;: 21, &quot;pets&quot;: [{&quot;name&quot;:&quot;Ruffus&quot;, &quot;type&quot;:&quot;dog&quot;,&quot;age&quot;:5}]}+
	Then the client will be notified of the second record change

Scenario: The client will no longer get notified after it unsubscribes to the path
	Given the client unsubscribes to &quot;pets.0.age&quot; for the record &quot;subscribeRecord&quot;
	When the server sends the message R|P|subscribeRecord|132|pets.0.age|N6+
	Then the client will not be notified of the record change</code></pre>
    </div>
    <div class="section">  
        <a name="Record Timeouts"></a>
        <pre><code class="language-gherkin">@records
Feature: Record Timeouts
	Records have multiple different actions they can be made, and each
	of those actions have their own timeouts.
	
	These timeouts allow you to notify the user if an error has 
	occured due to connection issues and gives you granular events to 
	allow different reactions to different situations.

	The timeouts are:

	ACK_TIMEOUT 
		If the user does not recieve a timeout when initially 
		requesting a record or discarding it.

	RESPONSE_TIMEOUT
		If the user does not recieve the data in a timely fashion.

	DELETE_TIMEOUT
		This is when the backend does not respond when a record is deleted.
	
	CACHE_RETRIEVAL_TIMEOUT 
	STORAGE_RETRIEVAL_TIMEOUT
		This is a specific backend issue and does not need to be 
		exposed to the user, but helps with logging issues.

Scenario: The client is connected
	Given the test server is ready
		And the client is initialised
		And the server sends the message C|A+
		And the client logs in with username &quot;XXX&quot; and password &quot;YYY&quot;
		And the server sends the message A|A+

@timeout
Scenario: The server does not respond in time with a record ACK
	When the client creates a record named &quot;unhappyRecord&quot;
		And some time passes
	Then the client throws a &quot;ACK_TIMEOUT&quot; error with message &quot;unhappyRecord&quot;

@timeout
Scenario: The server does not recieve initial record data in time
 	When the server sends the message R|A|S|unhappyRecord+
 		And some time passes
 	# TODO: Should this use another error code?
 	Then the client throws a &quot;RESPONSE_TIMEOUT&quot; error with message &quot;unhappyRecord&quot;

Scenario: The server then recieves the initial record data
	When the server sends the message R|R|unhappyRecord|100|{&quot;reasons&quot;:[&quot;Because.&quot;]}+

Scenario: The client sends an partial update
	When the client sets the record &quot;unhappyRecord&quot; to {&quot;reasons&quot;:[&quot;Just Because.&quot;]}
	Then the last message the server recieved is R|U|unhappyRecord|101|{&quot;reasons&quot;:[&quot;Just Because.&quot;]}+

@timeout
Scenario: The server send a cache retrieval timeout
 	When the server sends the message R|E|CACHE_RETRIEVAL_TIMEOUT|unhappyRecord+
 	Then the client throws a &quot;CACHE_RETRIEVAL_TIMEOUT&quot; error with message &quot;unhappyRecord&quot;
 
 @timeout
Scenario: The server send a storage retrieval timeout
 	When the server sends the message R|E|STORAGE_RETRIEVAL_TIMEOUT|unhappyRecord+
 	Then the client throws a &quot;STORAGE_RETRIEVAL_TIMEOUT&quot; error with message &quot;unhappyRecord&quot;

Scenario: The client discards record
	When the client discards the record named &quot;unhappyRecord&quot;
	Then the last message the server recieved is R|US|unhappyRecord+

@timeout
Scenario: The server does not respond in time with an unsubscribe ACK
	When some time passes
	Then the client throws a &quot;ACK_TIMEOUT&quot; error with message &quot;unhappyRecord&quot;

Scenario: The client deletes the record
	Given the client creates a record named &quot;unhappyRecord&quot;
		And the server sends the message R|A|S|unhappyRecord+
		And the server sends the message R|R|unhappyRecord|100|{&quot;reasons&quot;:[&quot;Because.&quot;]}+
	When the client deletes the record named &quot;unhappyRecord&quot;
	Then the last message the server recieved is R|D|unhappyRecord+

@timeout
Scenario: The server does not recieve an ack
	When some time passes
	Then the client throws a &quot;DELETE_TIMEOUT&quot; error with message &quot;unhappyRecord&quot;</code></pre>
    </div>
    <div class="section">  
        <a name="Record"></a>
        <pre><code class="language-gherkin">@records
Feature: Record
	Records are arbitrary JSON structures that can be manipulated and 
	subscribed to. Every change to a record is synced accross all 
	subscribed clients. 

	The actions that can be performed on a record are:
	- Request a record to recieve the current state and subcribe
	- Send or Recieve updates to the record
	- Discard the record when no longer needed on the client
	- Delete the record if no longer needed in the system

Scenario: The client is connected
	Given the test server is ready
		And the client is initialised
		And the server sends the message C|A+
		And the client logs in with username &quot;XXX&quot; and password &quot;YYY&quot;
		And the server sends the message A|A+

Scenario: The client creates a record
	Given the client creates a record named &quot;happyRecord&quot;
	Then the last message the server recieved is R|CR|happyRecord+

Scenario: The server sends a read ACK message for happyRecord
	Given the server sends the message R|A|S|happyRecord+

Scenario: The client receives the initial record data
	When the server sends the message R|R|happyRecord|100|{&quot;name&quot;:&quot;John&quot;, &quot;pets&quot;: [{&quot;name&quot;:&quot;Ruffles&quot;, &quot;type&quot;:&quot;dog&quot;,&quot;age&quot;:2}]}+
	Then the client record &quot;happyRecord&quot; data is {&quot;name&quot;:&quot;John&quot;, &quot;pets&quot;: [{&quot;name&quot;:&quot;Ruffles&quot;, &quot;type&quot;:&quot;dog&quot;,&quot;age&quot;:2}]}

Scenario: The client receives an partial update
	When the server sends the message R|P|happyRecord|101|pets.0.age|N3+
	Then the client record &quot;happyRecord&quot; data is {&quot;name&quot;:&quot;John&quot;, &quot;pets&quot;: [{&quot;name&quot;:&quot;Ruffles&quot;, &quot;type&quot;:&quot;dog&quot;,&quot;age&quot;:3}]}

Scenario: The client receives a full update
	When the server sends the message R|U|happyRecord|102|{&quot;name&quot;:&quot;Smith&quot;, &quot;pets&quot;: [{&quot;name&quot;:&quot;Ruffus&quot;, &quot;type&quot;:&quot;dog&quot;,&quot;age&quot;:4}]}+
	Then the client record &quot;happyRecord&quot; data is {&quot;name&quot;:&quot;Smith&quot;, &quot;pets&quot;: [{&quot;name&quot;:&quot;Ruffus&quot;, &quot;type&quot;:&quot;dog&quot;,&quot;age&quot;:4}]}

Scenario: The client sends an partial update
	When the client sets the record &quot;happyRecord&quot; &quot;pets.0.name&quot; to &quot;Max&quot;
	Then the last message the server recieved is R|P|happyRecord|103|pets.0.name|SMax+

Scenario: The client receives another full update
	When the client sets the record &quot;happyRecord&quot; to {&quot;name&quot;:&quot;Smith&quot;,&quot;pets&quot;:[{&quot;name&quot;:&quot;Ruffus&quot;,&quot;type&quot;:&quot;dog&quot;,&quot;age&quot;:5}]}
	Then the last message the server recieved is R|U|happyRecord|104|{&quot;name&quot;:&quot;Smith&quot;,&quot;pets&quot;:[{&quot;name&quot;:&quot;Ruffus&quot;,&quot;type&quot;:&quot;dog&quot;,&quot;age&quot;:5}]}+

Scenario: The client discards the record
	When the client discards the record named &quot;happyRecord&quot;
	Then the last message the server recieved is R|US|happyRecord+

Scenario: The server responds with a discard ACK
	When the server sends the message R|A|US|happyRecord+

Scenario: The client deletes the record
	Given the client creates a record named &quot;happyRecord&quot;
		And the server sends the message R|A|S|happyRecord+
		And the server sends the message R|R|happyRecord|100|{&quot;name&quot;:&quot;John&quot;, &quot;pets&quot;: [{&quot;name&quot;:&quot;Ruffles&quot;, &quot;type&quot;:&quot;dog&quot;,&quot;age&quot;:2}]}+	
		And the client deletes the record named &quot;happyRecord&quot;
	Then the last message the server recieved is R|D|happyRecord+

Scenario: The server responds with a delete ACK
	When the server sends the message R|A|D|happyRecord+</code></pre>
    </div>

			</div>
		</div>
		<script type="text/javascript" src="../../assets/js/docs.js"></script>
	</div>
	<div id="footer">
		<ul class="footer-items">

			<li class="footer-right">
				<ul class="social">
					<li class="twitter">
						<a href="//twitter.com/deepstreamIO">
							<i class="fa fa-twitter"></i>  Twitter
						</a>
					</li>
					<li class="github">
						<a href="//github.com/deepstreamIO">
							<i class="fa fa-github"></i>  Github
						</a>
					</li>
					<a href="//www.facebook.com/deepstreamIO/">
						<i class="fa fa-facebook"></i>  Facebook
					</a>
					<li class="stack-overflow">
						<a href="http://stackoverflow.com/questions/tagged/deepstream.io">
							<i class="fa fa-stack-overflow"></i>  Stack Overflow
						</a>
					</li>
					<li>
						<a href="//deepstream-slack.herokuapp.com/">
							<i class="fa fa-slack"></i>  Slack
						</a>
					</li>
				</ul>
			</li>

			<li class="footer-middle">
				<h4>Browse</h4>
				<ul>
					<li >
						<a href="../..">Home</a>
					</li>
					
					<li >
						<a href="../../download/">Downloads</a>
					</li>
					
					<li >
						<a href="../../tutorials/getting-started.html">Tutorials</a>
						
					</li>
					
					<li >
						<a href="../../docs/deepstream.html">Documentation</a>
						
					</li>
					
					<li >
						<a href="../../blog/">Blog</a>
					</li>
				
					<li class="active">
						<a href="../../info/">Info</a>
						
							<ul id="subnav">
					<li class="head first">Performance</li>
					<li >
						<a href="../../info/performance-overview.html">Overview</a>
						<div class="isActiveIndicator orangeGradient"></div>
					</li>	
					<li >
						<a href="../../info/performance-single-node-vs-cluster.html">Single Node vs Cluster</a>
						<div class="isActiveIndicator orangeGradient"></div>
					</li>
				
					<li class="head">Protocol</li>
					
					<li >
						<a href="../../info/messagestructure/writing-a-client.html">Writing a Client</a>
						<div class="isActiveIndicator orangeGradient"></div>
					</li>
				
					<li >
						<a href="../../info/messagestructure/index.html">Message Structure</a>
						<div class="isActiveIndicator orangeGradient"></div>
					</li>
				
					<li >
						<a href="../../info/messagestructure/specs.html">All Messages</a>
						<div class="isActiveIndicator orangeGradient"></div>
					</li>
				
					<li class="head">Client Specs</li>
						<li >
							<a href="../../info/messagestructure/parsing.html">
							Parsing</a>
							<div class="isActiveIndicator orangeGradient"></div>
						</li>
						<li >
							<a href="../../info/messagestructure/rpc.html">
							Rpc</a>
							<div class="isActiveIndicator orangeGradient"></div>
						</li>
						<li class="active">
							<a href="../../info/messagestructure/records.html">
							Records</a>
							<div class="isActiveIndicator orangeGradient"></div>
								<ul class="overview">
									<li><a href="#Record Conflicts">Record Conflicts</a></li>
									<li><a href="#Record Connectivity">Record Connectivity</a></li>
									<li><a href="#Record Listen Timeouts">Record Listen Timeouts</a></li>
									<li><a href="#Record Listen">Record Listen</a></li>
									<li><a href="#Record Misc">Record Misc</a></li>
									<li><a href="#Record Subscription">Record Subscription</a></li>
									<li><a href="#Record Timeouts">Record Timeouts</a></li>
									<li><a href="#Record">Record</a></li>
								</ul>
						</li>
						<li >
							<a href="../../info/messagestructure/events.html">
							Events</a>
							<div class="isActiveIndicator orangeGradient"></div>
						</li>
						<li >
							<a href="../../info/messagestructure/connectivity.html">
							Connectivity</a>
							<div class="isActiveIndicator orangeGradient"></div>
						</li>
					
					
				
				</ul>
					
						
					</li>
				
				</ul>			</li>

			<li class="footer-left">
				<h4>Star this project on github!</h4>
				<p>
					<a class="github-button" href="//github.com/deepstreamIO/deepstream.io" data-icon="octicon-star" data-style="mega" data-count-href="/deepstreamIO/deepstream.io/stargazers" data-count-api="/repos/deepstreamIO/deepstream.io#stargazers_count" data-count-aria-label="# stargazers on GitHub" aria-label="Star deepstreamIO/deepstream.io on GitHub">Star</a>
				</p>

				<h4>Contact the team</h4>
				<p>
					<a href="mailto:info@deepstream.io">info@deepstream.io</a>
					<ul class="address">
						<li><strong>deepstreamHub GmbH</strong></li>
						<li>Lindenstrasse 20-25</li>
						<li>10969 Berlin</li>
						<li>Germany</li>
					</ul>
				</p>
			</li>

		</ul>
	</div>


	<script async defer id="github-bjs" src="//buttons.github.io/buttons.js"></script>
</body>
</html>
